(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[24],{"Yzj/":function(e,t,a){"use strict";a.r(t);a("g9YV");var i,n,r,o=a("wCAj"),s=(a("14J3"),a("BMrR")),c=(a("jCWc"),a("kPKH")),m=(a("DZo9"),a("8z0m")),l=a("jehZ"),d=a.n(l),g=(a("+L6B"),a("2/Rp")),p=(a("5NDa"),a("5rEg")),h=(a("2qtc"),a("kLXV")),u=a("p0pE"),f=a.n(u),y=a("2Taf"),v=a.n(y),b=a("vZ4D"),w=a.n(b),O=a("l4Ni"),j=a.n(O),M=a("ujKo"),k=a.n(M),x=a("MhPg"),E=a.n(x),I=a("q1tI"),z=a.n(I),C=a("MuoO"),D=a("LLXN"),S=a("wd/R"),L=a.n(S),q=a("Dlz4"),R=a("ZeOv"),B=(i=Object(C["connect"])(function(e){var t=e.image,a=e.loading;return{image:t,loading:a.models.image}}),i((r=function(e){function t(e){var a;v()(this,t),a=j()(this,k()(t).call(this,e)),a.imgView={show:function(e){return function(){a.setState({imgView:!0,imgUrl:e})}},hide:function(){a.setState({imgView:!1,imgUrl:null})}},a.onSearchImage=function(e){var t=a.props.match.params.type;a.query.title=e,a.query.page=1,a.initData(t)},a.onChangeTable=function(e,t,i){var n,r,o=a.props.match.params.type,s=e.current,c=e.pageSize;i.order&&(n="descend"===i.order?-1:1,r=i.field),a.query=f()({},a.query,{size:c,page:s,sortBy:r,sortOrder:n}),a.initData(o)},a.initData=function(e){var t=a.props.dispatch;t({type:"image/queryImageList",payload:{params:{type:e},query:a.query}})},a.removeImage=function(e){return function(){var t=[e];a.deleteBatch(t)}},a.removeImageList=function(){var e=a.state.selectedRowKeys;h["a"].confirm({title:Object(D["formatMessage"])({id:"image.delete"}),content:Object(D["formatMessage"])({id:"image.delete.batch.tips"}),okText:Object(D["formatMessage"])({id:"common.confirm"}),cancelText:Object(D["formatMessage"])({id:"common.cancel"}),onOk:function(){a.deleteBatch(e),a.setState({selectedRowKeys:[]})}})},a.deleteBatch=function(e){var t=a.props,i=t.dispatch,n=t.match.params.type;i({type:"image/deleteImage",payload:{data:{ids:e}}}).then(function(e){e&&a.initData(n)})},a.handleChange=function(e){if("uploading"!==e.file.status){if("done"===e.file.status){a.setState({iconLoading:!1});var t=a.props.match.params.type;a.initData(t)}}else a.setState({iconLoading:!0})};var i=e.location.state,n=void 0===i?{}:i;return a.state={selectedRowKeys:[],imgView:!1,imgUrl:"",iconLoading:!1},a.query={title:n.title,size:n.size?n.size:10,page:n.page?n.page:1,sortBy:n.sortBy,sortOrder:n.sortOrder},a}return E()(t,e),w()(t,[{key:"componentDidMount",value:function(){var e=this.props.match.params.type;this.initData(e)}},{key:"componentWillReceiveProps",value:function(e){var t=e.match.params.type,a=this.props.match.params.type;t!==a&&this.initData(t)}},{key:"render",value:function(){var e=this,t=p["a"].Search,a=this.props,i=a.loading,n=a.image,r=a.match.params.type,l=this.state,u=l.selectedRowKeys,y=l.imgUrl,v=l.imgView,b=l.iconLoading,w=n[r].map(function(e){var t=e.name,a=t.split("/")[3]?t.split("/")[3].split(".")[0]:null,i=t.split("/")[3]?t.split("/")[3].split(".")[1]:null;return f()({},e,{cover:e.name,name:a,kind:i})}),O=[{title:Object(D["formatMessage"])({id:"image.cover"}),dataIndex:"cover",key:"cover",render:function(t){return z.a.createElement("img",{alt:"avatar",src:t,style:{height:"60px",borderRadius:"3px",boxShadow:"0 0 10px 20px rgba(0,0,0,0.03)"},onClick:e.imgView.show(t)})}},{title:Object(D["formatMessage"])({id:"image.name"}),dataIndex:"name",sorter:!0,key:"name"},{title:Object(D["formatMessage"])({id:"image.size"}),dataIndex:"size",key:"size",sorter:!0,align:"center",render:function(e){return e<1048576?Math.floor(e/1024)+Object(D["formatMessage"])({id:"image.size.kb"}):(e/1024/1024).toFixed(2)+Object(D["formatMessage"])({id:"image.size.mb"})}},{title:Object(D["formatMessage"])({id:"image.kind"}),dataIndex:"kind",key:"kind",align:"center"},{title:Object(D["formatMessage"])({id:"image.created"}),dataIndex:"birthtime",sorter:!0,key:"birthtime",align:"center",render:function(e){return L()(e).format("YYYY-MM-DD HH:mm:ss")}},{title:Object(D["formatMessage"])({id:"image.option"}),key:"action",dataIndex:"cover",align:"center",render:function(t){return z.a.createElement("a",{onClick:e.removeImage(t)},Object(D["formatMessage"])({id:"image.delete"}))}}],j={selectedRowKeys:u,onChange:function(t){e.setState({selectedRowKeys:t})}},M=Object(R["e"])(this.query.page,this.query.size,n[r].total);return z.a.createElement("div",{className:"tableList"},z.a.createElement(s["a"],{className:"head"},z.a.createElement(c["a"],{span:16,style:{height:"30px"}},z.a.createElement(m["a"],d()({name:"file",showUploadList:!1,onChange:this.handleChange,data:{type:r}},q["a"]),z.a.createElement(g["a"],{icon:"plus",type:"primary",loading:b},Object(D["formatMessage"])({id:"image.upload"}))),u.length>0&&z.a.createElement(g["a"],{onClick:this.removeImageList},Object(D["formatMessage"])({id:"common.delete.batch"}))),z.a.createElement(c["a"],{span:8},z.a.createElement(t,{placeholder:Object(D["formatMessage"])({id:"image.search"}),onSearch:this.onSearchImage,enterButton:!0}))),z.a.createElement(o["a"],{loading:i,columns:O,rowSelection:j,dataSource:w,rowKey:"cover",pagination:M,onChange:this.onChangeTable}),z.a.createElement(h["a"],{visible:v,footer:null,onCancel:this.imgView.hide,centered:!0,width:"70vw",style:{textAlign:"center"}},z.a.createElement("img",{alt:Object(D["formatMessage"])({id:"common.image"}),style:{maxWidth:"100%",maxHeight:"60vh"},src:y})))}}]),t}(I["Component"]),n=r))||n);t["default"]=B}}]);