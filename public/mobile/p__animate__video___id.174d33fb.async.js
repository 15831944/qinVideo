(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{"4Mdj":function(e,t,n){"use strict";n.r(t);n("T2oS");var a=n("W9HT"),i=(n("miYZ"),n("tsqr")),r=n("mrSG"),o=n("q1tI"),c=n.n(o),l=n("MuoO"),s=n("fFZ8"),m=n.n(s),d=(n("Znn+"),n("ZTPi")),p=n("vOnD"),u=n("Gwa3"),g=n("LLXN"),h=n("yDSA"),f=n("qIgq"),b=n.n(f),v=n("zz3R"),E=n("wd/R"),x=n.n(E),y=n("xEAY");function w(){var e=m()(["\n  margin: -10px 0 10px 0;\n\n  .head {\n    height: 30px;\n    line-height: 30px;\n    display: grid;\n    grid-template-columns: 50px 1fr 60px;\n    font-size: 0.9em;\n    opacity: 0.6;\n    font-weight: 700;\n  }\n\n  .main {\n    .list {\n      line-height: 24px;\n      display: grid;\n      grid-template-columns: 50px 1fr 60px;\n      font-size: 0.8em;\n      opacity: 0.6;\n      cursor: pointer;\n\n      span:nth-child(2) {\n        font-weight: 500;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: pre;\n        word-break: keep-all;\n      }\n\n      span:nth-child(3) {\n        text-align: center;\n      }\n\n      &:hover {\n        color: ",";\n      }\n    }\n  }\n"]);return w=function(){return e},e}var j=e=>{var t=Math.floor(e/60),n=Math.floor(e%60);return"".concat(Object(y["b"])(t),":").concat(Object(y["b"])(n))},O=p["a"].div(w(),e=>e.color),k=e=>{var t=e.id,n=Object(o["useContext"])(u["a"]),i=Object(o["useMemo"])(()=>n,[n]),r=Object(o["useState"])([]),l=b()(r,2),s=l[0],m=l[1],d=Object(o["useState"])(!0),p=b()(d,2),h=p[0],f=p[1];return Object(o["useEffect"])(()=>{t&&v["a"].queryDanmu({query:{id:t}}).then(e=>{m(e.data.list),f(!1)})},[t]),c.a.createElement(O,{color:i},c.a.createElement("div",{className:"head"},c.a.createElement("span",null,Object(g["formatMessage"])({id:"danmu.time"})),c.a.createElement("span",null,Object(g["formatMessage"])({id:"danmu.content"})),c.a.createElement("span",null,Object(g["formatMessage"])({id:"danmu.created"}))),c.a.createElement(a["a"],{spinning:h},c.a.createElement("div",{className:"main"},s.map(e=>c.a.createElement("div",{className:"list"},c.a.createElement("span",null,j(e.time)),c.a.createElement("span",null,e.text),c.a.createElement("span",null,x()(e.createdAt).format("MM-DD")))))))},M=k,N=n("DNCa"),D=n("YO1i"),q=n("3a4m"),I=n.n(q),z=n("qHAN"),C=n("xK/y"),S=n.n(C),A=n("ulZh"),P=n.n(A),_=e=>{var t=e.info,n=t.id,a=t.link,i=t.danmu,r=t.type,l=t.preview,s=t.subtitle,m=Object(o["useContext"])(u["a"]),d=Object(o["useMemo"])(()=>m,[m]);window.Hls=P.a;var p=()=>{var e,t=window.config.usePicInterface?window.config.picInterface:window.config.dplayer,o=window.config.danmuAuth||!1,c=!o||!!localStorage.getItem("token");if(a&&a.length>1){var m=a.map(e=>({name:e.name,url:e.value,type:"auto"}));e={quality:m,defaultQuality:0,pic:t}}else{var p=a&&a[0]&&a[0].value||"";e={url:p,pic:t,type:"m3u8"===r?"hls":"auto"}}l&&l.length>0&&(e.thumbnails=l[0]);var u={container:document.getElementById("dplayer"),autoplay:!0,theme:d,screenshot:!1,hotkey:!0,preload:"auto",volume:.7,mutex:!0,video:e,danmaku:c?{id:n,api:"/api/v2/danmus",maximum:1e4,bottom:"15%",unlimited:!0,addition:i?["https://api.prprpr.me/dplayer/v3/bilibili?aid=".concat(i)]:[]}:null};s&&s.length>0&&(u.subtitle={url:s[0].value,type:"webvtt"}),l&&new S.a(u)};return Object(o["useEffect"])(()=>{"php"!==r&&a&&p()},[n]),c.a.createElement(c.a.Fragment,null,"php"===r?c.a.createElement("iframe",{style:{width:"100%",height:"100%",border:"none"},src:a}):c.a.createElement("div",{id:"dplayer"}))},Z=_,T=n("qki9");function F(){var e=m()(["\n  .player {\n    margin-top: 40px;\n    z-index: 999;\n    background-color: rgba(0, 0, 0, 0.1);\n  }\n\n  .eposide {\n    border-top: solid 6px #ebebeb;\n  }\n\n  .info {\n    border-top: solid 6px #ebebeb;\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    padding: 15px;\n\n    .cover {\n      width: 90px;\n      height: 120px;\n      border-radius: 5px;\n      background-color: rgba(0, 0, 0, 0.05);\n      box-shadow: 0 3px 14px 0 hsla(22, 4%, 52%, 0.4);\n      background-size: cover;\n      background-position: center;\n      cursor: pointer;\n    }\n\n    .main {\n      width: calc(100% - 105px);\n      height: 120px;\n      display: flex;\n      flex-direction: column;\n      justify-content: space-between;\n      align-items: flex-start;\n\n      .title {\n        height: 30px;\n        line-height: 30px;\n        font-weight: bold;\n        width: 100%;\n        text-overflow: ellipsis;\n        overflow: hidden;\n        white-space: keep-all;\n      }\n      .count {\n        display: flex;\n        justify-content: flex-start;\n        align-items: center;\n        height: 1.5rem;\n\n        span.icon {\n          margin-right: 20px;\n          i {\n            margin-right: 5px;\n          }\n        }\n      }\n      .introduce {\n        color: #515a6e;\n        height: 4rem;\n        font-size: 12px;\n        line-height: 1rem;\n        overflow: hidden;\n      }\n    }\n  }\n\n  .comment {\n    border-top: solid 6px #ebebeb;\n    padding: 0 15px;\n  }\n"]);return F=function(){return e},e}var H=d["a"].TabPane,Y=p["a"].div(F()),G=e=>{var t=e.info,n=Object(o["useContext"])(u["a"]),a=Object(o["useMemo"])(()=>n,[n]);return c.a.createElement(Y,{color:a},c.a.createElement("div",{className:"player"},c.a.createElement(Z,{info:t})),c.a.createElement("div",{className:"eposide"},c.a.createElement(h["a"],{cover:t.target&&t.target.coverVertical,eposide:t.eposides,target:t._id})),c.a.createElement("div",{className:"info"},c.a.createElement("div",{className:"cover",style:{backgroundImage:"url(".concat(t.target&&t.target.coverVertical,")")},onClick:()=>{I.a.push("/animate/".concat(t.target&&t.target.slug))}}),c.a.createElement("div",{className:"main"},c.a.createElement("div",{className:"title"},t.title),c.a.createElement("div",{className:"count"},c.a.createElement("span",{className:"icon"},c.a.createElement(D["a"],{type:"icon-youtube"}),t.countPlay),c.a.createElement("span",{className:"icon"},c.a.createElement(D["a"],{type:"icon-comment1"}),t.countComment),c.a.createElement("span",{className:"icon"},c.a.createElement(D["a"],{type:"icon-pinglun"}),t.countDanmu),c.a.createElement("span",{className:"icon"},c.a.createElement(T["a"],null,c.a.createElement(z["a"],{type:"Animate",target:t._id,onModel:"Eposide"},c.a.createElement(D["a"],{type:"icon-icon_report_fill"}),Object(g["formatMessage"])({id:"report.question"}))))),c.a.createElement("div",{className:"introduce"},t.target&&t.target.introduce&&t.target.introduce.slice(0,120)))),c.a.createElement("div",{className:"comment"},c.a.createElement(d["a"],{defaultActiveKey:"1"},c.a.createElement(H,{tab:Object(g["formatMessage"])({id:"animate.play.tabs.danmu"}),key:"1"},c.a.createElement(M,{id:t._id})),c.a.createElement(H,{tab:"".concat(Object(g["formatMessage"])({id:"animate.tabs.comment"}),"(").concat(t.countComment||0,")"),key:"2"},c.a.createElement(N["a"],{target:t._id,onModel:"Eposide",mobile:!0})))))},J=G,K=class extends o["Component"]{constructor(e){super(e),this.initData=(()=>{var e=this.state.id,t=this.props.dispatch;null!==e?t({type:"animate/getPlayInfo",payload:{params:{id:e}}}).then(e=>{e&&e.data&&this.setState({info:e.data})}):i["a"].error(Object(g["formatMessage"])({id:"error.data.few"}))}),this.state={id:e.match.params.id,info:{link:[]}}}static getDerivedStateFromProps(e,t){return e.match.params.id!==t.id?{id:e.match.params.id}:null}componentDidMount(){this.initData()}componentDidUpdate(e,t){t.id!==this.state.id&&this.initData()}render(){var e=this.props.loading,t=this.state.info;return c.a.createElement(a["a"],{spinning:e,size:"large"},c.a.createElement(J,{info:t}))}};K=Object(r["a"])([Object(l["connect"])(e=>{var t=e.animate,n=e.loading;return{animate:t,loading:n.effects["animate/getPlayInfo"]}})],K);t["default"]=K}}]);